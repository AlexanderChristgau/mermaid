

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Forward models &mdash; mermaid 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="mermaid 0.1 documentation" href="index.html"/>
        <link rel="next" title="Image sampling" href="image_sampling.html"/>
        <link rel="prev" title="Finite differences" href="finite_differences.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> mermaid
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notes/howto_own_registration.html">How to write your own registration model</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/parameters.html">Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/simple_example.html">Simple example</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/todos.html">TODOs</a></li>
</ul>
<p class="caption"><span class="caption-text">Package Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="custom_optimizers.html">Custom optimizers</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_pytorch_extensions.html">Custom pyTorch extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_generation.html">Example generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="finite_differences.html">Finite differences</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Forward models</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_sampling.html">Image sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_factory.html">Model factory</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_parameters.html">Parameter module</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiscale_optimizer.html">Multiscale optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="registration_networks.html">Registration networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="regularizer_factory.html">Regularizer factory</a></li>
<li class="toctree-l1"><a class="reference internal" href="rungekutta_integrators.html">Runge-Kutta integrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="similarity_measure_factory.html">Similarity measure factory</a></li>
<li class="toctree-l1"><a class="reference internal" href="smoother_factory.html">Smoother factory</a></li>
<li class="toctree-l1"><a class="reference internal" href="stn.html">Spatial transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="viewers.html">Viewers</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualize_registration_results.html">Visualize registration results</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">mermaid</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Forward models</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/forward_models.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="forward-models">
<h1>Forward models<a class="headerlink" href="#forward-models" title="Permalink to this headline">¶</a></h1>
<img src="_images/inheritance-41c12a3dec94020e2b9001d13f27b3c3e17b3055.png" alt="Inheritance diagram of forward_models" usemap="#inheritancea870ec6bf9" class="inheritance"/>
<map id="inheritancea870ec6bf9" name="inheritancea870ec6bf9">
<area shape="rect" id="node1" href="#forward_models.AdvectImage" target="_top" title="Forward model to advect an image using a transport equation: :math:`I_t + 
abla I^Tv = 0`." alt="" coords="256,5,430,26"/>
<area shape="rect" id="node2" href="#forward_models.ForwardModel" target="_top" title="Abstract forward model class. Should never be instantiated." alt="" coords="5,89,185,110"/>
<area shape="rect" id="node3" href="#forward_models.AdvectMap" target="_top" title="Forward model to advect an n&#45;D map using a transport equation: :math:`Phi_t + DPhi v = 0`." alt="" coords="261,47,425,68"/>
<area shape="rect" id="node4" href="#forward_models.EPDiffImage" target="_top" title="Forward model for the EPdiff equation. State is the momentum, m, and the image I:" alt="" coords="257,89,428,110"/>
<area shape="rect" id="node5" href="#forward_models.EPDiffMap" target="_top" title="Forward model for the EPDiff equation. State is the momentum, m, and the transform, :math:`phi` " alt="" coords="262,131,423,153"/>
<area shape="rect" id="node6" href="#forward_models.EPDiffScalarMomentum" target="_top" title="Base class for scalar momentum EPDiff solutions. Defines a smoother that can be commonly used." alt="" coords="227,174,458,195"/>
<area shape="rect" id="node7" href="#forward_models.EPDiffScalarMomentumImage" target="_top" title="Forward model for the scalar momentum EPdiff equation. State is the scalar momentum, lam, and the image I" alt="" coords="500,153,763,174"/>
<area shape="rect" id="node8" href="#forward_models.EPDiffScalarMomentumMap" target="_top" title="Forward model for the scalar momentum EPDiff equation. State is the scalar momentum, lam, the image, I, and the transform, phi." alt="" coords="505,195,758,216"/>
<area shape="rect" id="node9" href="#forward_models.RHSLibrary" target="_top" title="Convenience class to quickly generate various right hand sides (RHSs) of popular partial differential " alt="" coords="12,47,178,68"/>
</map>
<span class="target" id="module-forward_models"></span><p>Package defining various dynamic forward models as well as convenience methods to generate the
right hand sides (RHS) of the related partial differential equations.</p>
<dl class="docutils">
<dt>Currently, the following forward models are implemented:</dt>
<dd><ol class="first last arabic simple">
<li>An advection equation for images</li>
<li>An advection equation for maps</li>
<li>The EPDiff-equation parameterized using the vector-valued momentum for images</li>
<li>The EPDiff-equation parameterized using the vector-valued momentum for maps</li>
<li>The EPDiff-equation parameterized using the scalar-valued momentum for images</li>
<li>The EPDiff-equation parameterized using the scalar-valued momentum for maps</li>
</ol>
</dd>
</dl>
<p>The images are expected to be tensors of dimension: BxCxXxYxZ (or BxCxX in 1D and BxCxXxY in 2D),
where B is the batch-size, C the number of channels, and X, Y, and Z are the spatial coordinate indices.</p>
<dl class="docutils">
<dt>Futhermore the following (RHSs) are provided</dt>
<dd><ol class="first last arabic simple">
<li>Image advection</li>
<li>Map advection</li>
<li>Scalar conservation law</li>
<li>EPDiff</li>
</ol>
</dd>
</dl>
<dl class="class">
<dt id="forward_models.RHSLibrary">
<em class="property">class </em><code class="descclassname">forward_models.</code><code class="descname">RHSLibrary</code><span class="sig-paren">(</span><em>spacing</em>, <em>use_neumann_BC_for_map=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#RHSLibrary"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.RHSLibrary" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenience class to quickly generate various right hand sides (RHSs) of popular partial differential
equations. In this way new forward models can be written with minimal code duplication.</p>
<dl class="attribute">
<dt id="forward_models.RHSLibrary.spacing">
<code class="descname">spacing</code><em class="property"> = None</em><a class="headerlink" href="#forward_models.RHSLibrary.spacing" title="Permalink to this definition">¶</a></dt>
<dd><p>spatial spacing</p>
</dd></dl>

<dl class="attribute">
<dt id="forward_models.RHSLibrary.fdt">
<code class="descname">fdt</code><em class="property"> = None</em><a class="headerlink" href="#forward_models.RHSLibrary.fdt" title="Permalink to this definition">¶</a></dt>
<dd><p>torch finite differencing support</p>
</dd></dl>

<dl class="attribute">
<dt id="forward_models.RHSLibrary.fdt_le">
<code class="descname">fdt_le</code><em class="property"> = None</em><a class="headerlink" href="#forward_models.RHSLibrary.fdt_le" title="Permalink to this definition">¶</a></dt>
<dd><p>torch finite differencing support w/ linear extrapolation</p>
</dd></dl>

<dl class="attribute">
<dt id="forward_models.RHSLibrary.dim">
<code class="descname">dim</code><em class="property"> = None</em><a class="headerlink" href="#forward_models.RHSLibrary.dim" title="Permalink to this definition">¶</a></dt>
<dd><p>spatial dimension</p>
</dd></dl>

<dl class="attribute">
<dt id="forward_models.RHSLibrary.use_neumann_BC_for_map">
<code class="descname">use_neumann_BC_for_map</code><em class="property"> = None</em><a class="headerlink" href="#forward_models.RHSLibrary.use_neumann_BC_for_map" title="Permalink to this definition">¶</a></dt>
<dd><p>If True uses zero Neumann boundary conditions also for evolutions of the map, if False uses linear extrapolation</p>
</dd></dl>

<dl class="method">
<dt id="forward_models.RHSLibrary.rhs_advect_image_multiNC">
<code class="descname">rhs_advect_image_multiNC</code><span class="sig-paren">(</span><em>I</em>, <em>v</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#RHSLibrary.rhs_advect_image_multiNC"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.RHSLibrary.rhs_advect_image_multiNC" title="Permalink to this definition">¶</a></dt>
<dd><p>Advects a batch of images which can be multi-channel. Expected image format here, is
BxCxXxYxZ, where B is the number of images (batch size), C, the number of channels
per image and X, Y, Z are the spatial coordinates (X only in 1D; X,Y only in 2D)
if the channel size is 1, then a fast version will be used, which batch can be calculate in one loop
otherwise the traditional loop batch and loop channel way will be used</p>
<p><span class="math">\(-\nabla I^Tv\)</span></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>I</strong> – Image batch</li>
<li><strong>v</strong> – Velocity fields (this will be one velocity field per image)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Returns the RHS of the advection equations involved</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="forward_models.RHSLibrary.rhs_scalar_conservation_multiNC">
<code class="descname">rhs_scalar_conservation_multiNC</code><span class="sig-paren">(</span><em>I</em>, <em>v</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#RHSLibrary.rhs_scalar_conservation_multiNC"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.RHSLibrary.rhs_scalar_conservation_multiNC" title="Permalink to this definition">¶</a></dt>
<dd><p>Scalar conservation law for a batch of images which can be multi-channel. Expected image format here, is
BxCxXxYxZ, where B is the number of images (batch size), C, the number of channels
per image and X, Y, Z are the spatial coordinates (X only in 1D; X,Y only in 2D)</p>
<p>if the channel size is 1, then a fast version will be used, which batch can be calculate in one loop
otherwise the traditional loop batch and loop channel way will be used</p>
<p><span class="math">\(-div(Iv)\)</span></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>I</strong> – Image batch</li>
<li><strong>v</strong> – Velocity fields (this will be one velocity field per image)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Returns the RHS of the scalar conservation law equations involved</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="forward_models.RHSLibrary.rhs_advect_map_multiN">
<code class="descname">rhs_advect_map_multiN</code><span class="sig-paren">(</span><em>phi</em>, <em>v</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#RHSLibrary.rhs_advect_map_multiN"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.RHSLibrary.rhs_advect_map_multiN" title="Permalink to this definition">¶</a></dt>
<dd><p>Advects a set of N maps (for N images). Expected format here, is
BxCxXxYxZ, where B is the number of images/maps (batch size), C, the number of channels
per (here the spatial dimension for the map coordinate functions),
and X, Y, Z are the spatial coordinates (X only in 1D; X,Y only in 2D)</p>
<p>new fast version is implemented, where batch is no longer calculated separately</p>
<p><span class="math">\(-D\phi v\)</span></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>phi</strong> – map batch</li>
<li><strong>v</strong> – Velocity fields (this will be one velocity field per map)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Returns the RHS of the advection equations involved</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="forward_models.RHSLibrary.rhs_epdiff_multiN">
<code class="descname">rhs_epdiff_multiN</code><span class="sig-paren">(</span><em>m</em>, <em>v</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#RHSLibrary.rhs_epdiff_multiN"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.RHSLibrary.rhs_epdiff_multiN" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the right hand side of the EPDiff equation for of N momenta (for N images).
Expected format here, is BxCxXxYxZ, where B is the number of momenta (batch size), C,
the number of channels per (here the spatial dimension for the momenta),
and X, Y, Z are the spatial coordinates (X only in 1D; X,Y only in 2D)</p>
<p>a new version, where batch is no longer calculated separately</p>
<p><span class="math">\(-(div(m_1v),...,div(m_dv))^T-(Dv)^Tm\)</span></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>m</strong> – momenta batch</li>
<li><strong>v</strong> – Velocity fields (this will be one velocity field per momentum)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Returns the RHS of the EPDiff equations involved</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="forward_models.ForwardModel">
<em class="property">class </em><code class="descclassname">forward_models.</code><code class="descname">ForwardModel</code><span class="sig-paren">(</span><em>sz</em>, <em>spacing</em>, <em>params=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#ForwardModel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.ForwardModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Abstract forward model class. Should never be instantiated.
Derived classes require the definition of f(self,t,x,u,pars) and u(self,t,pars).
These functions will be used for integration: x’(t) = f(t,x(t),u(t))</p>
<dl class="attribute">
<dt id="forward_models.ForwardModel.dim">
<code class="descname">dim</code><em class="property"> = None</em><a class="headerlink" href="#forward_models.ForwardModel.dim" title="Permalink to this definition">¶</a></dt>
<dd><p>spatial dimension</p>
</dd></dl>

<dl class="attribute">
<dt id="forward_models.ForwardModel.spacing">
<code class="descname">spacing</code><em class="property"> = None</em><a class="headerlink" href="#forward_models.ForwardModel.spacing" title="Permalink to this definition">¶</a></dt>
<dd><p>spatial spacing</p>
</dd></dl>

<dl class="attribute">
<dt id="forward_models.ForwardModel.sz">
<code class="descname">sz</code><em class="property"> = None</em><a class="headerlink" href="#forward_models.ForwardModel.sz" title="Permalink to this definition">¶</a></dt>
<dd><p>image size (BxCxXxYxZ)</p>
</dd></dl>

<dl class="attribute">
<dt id="forward_models.ForwardModel.params">
<code class="descname">params</code><em class="property"> = None</em><a class="headerlink" href="#forward_models.ForwardModel.params" title="Permalink to this definition">¶</a></dt>
<dd><p>ParameterDict instance holding parameters</p>
</dd></dl>

<dl class="attribute">
<dt id="forward_models.ForwardModel.rhs">
<code class="descname">rhs</code><em class="property"> = None</em><a class="headerlink" href="#forward_models.ForwardModel.rhs" title="Permalink to this definition">¶</a></dt>
<dd><p>rhs library support</p>
</dd></dl>

<dl class="attribute">
<dt id="forward_models.ForwardModel.fdt">
<code class="descname">fdt</code><em class="property"> = None</em><a class="headerlink" href="#forward_models.ForwardModel.fdt" title="Permalink to this definition">¶</a></dt>
<dd><p>torch finite difference support</p>
</dd></dl>

<dl class="method">
<dt id="forward_models.ForwardModel.f">
<code class="descname">f</code><span class="sig-paren">(</span><em>t</em>, <em>x</em>, <em>u</em>, <em>pars</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#ForwardModel.f"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.ForwardModel.f" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to be integrated</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>t</strong> – time</li>
<li><strong>x</strong> – state</li>
<li><strong>u</strong> – input</li>
<li><strong>pars</strong> – optional parameters</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the function value, should return a list (to support easy concatenations of states)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="forward_models.ForwardModel.u">
<code class="descname">u</code><span class="sig-paren">(</span><em>t</em>, <em>pars</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#ForwardModel.u"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.ForwardModel.u" title="Permalink to this definition">¶</a></dt>
<dd><p>External input</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>t</strong> – time</li>
<li><strong>pars</strong> – parameters</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the external input</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="forward_models.AdvectMap">
<em class="property">class </em><code class="descclassname">forward_models.</code><code class="descname">AdvectMap</code><span class="sig-paren">(</span><em>sz</em>, <em>spacing</em>, <em>params=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#AdvectMap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.AdvectMap" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward model to advect an n-D map using a transport equation: <span class="math">\(\Phi_t + D\Phi v = 0\)</span>.
v is treated as an external argument and Phi is the state</p>
<dl class="method">
<dt id="forward_models.AdvectMap.u">
<code class="descname">u</code><span class="sig-paren">(</span><em>t</em>, <em>pars</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#AdvectMap.u"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.AdvectMap.u" title="Permalink to this definition">¶</a></dt>
<dd><p>External input, to hold the velocity field</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>t</strong> – time (ignored; not time-dependent)</li>
<li><strong>pars</strong> – assumes an n-D velocity field is passed as the only input argument</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Simply returns this velocity field</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="forward_models.AdvectMap.f">
<code class="descname">f</code><span class="sig-paren">(</span><em>t</em>, <em>x</em>, <em>u</em>, <em>pars</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#AdvectMap.f"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.AdvectMap.f" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to be integrated, i.e., right hand side of transport equation:</p>
<p><span class="math">\(-D\phi v\)</span></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>t</strong> – time (ignored; not time-dependent)</li>
<li><strong>x</strong> – state, here the map, Phi, itself (assumes 3D-5D array; [nrI,0,:,:] x-coors; [nrI,1,:,:] y-coors; …</li>
<li><strong>u</strong> – external input, will be the velocity field here</li>
<li><strong>pars</strong> – ignored (does not expect any additional inputs)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">right hand side [phi]</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="forward_models.AdvectImage">
<em class="property">class </em><code class="descclassname">forward_models.</code><code class="descname">AdvectImage</code><span class="sig-paren">(</span><em>sz</em>, <em>spacing</em>, <em>params=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#AdvectImage"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.AdvectImage" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward model to advect an image using a transport equation: <span class="math">\(I_t + \nabla I^Tv = 0\)</span>.
v is treated as an external argument and I is the state</p>
<dl class="method">
<dt id="forward_models.AdvectImage.u">
<code class="descname">u</code><span class="sig-paren">(</span><em>t</em>, <em>pars</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#AdvectImage.u"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.AdvectImage.u" title="Permalink to this definition">¶</a></dt>
<dd><p>External input, to hold the velocity field</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>t</strong> – time (ignored; not time-dependent)</li>
<li><strong>pars</strong> – assumes an n-D velocity field is passed as the only input argument</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Simply returns this velocity field</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="forward_models.AdvectImage.f">
<code class="descname">f</code><span class="sig-paren">(</span><em>t</em>, <em>x</em>, <em>u</em>, <em>pars</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#AdvectImage.f"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.AdvectImage.f" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to be integrated, i.e., right hand side of transport equation: <span class="math">\(-\nabla I^T v\)</span></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>t</strong> – time (ignored; not time-dependent)</li>
<li><strong>x</strong> – state, here the image, I, itself (supports multiple images and channels)</li>
<li><strong>u</strong> – external input, will be the velocity field here</li>
<li><strong>pars</strong> – ignored (does not expect any additional inputs)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">right hand side [I]</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="forward_models.EPDiffImage">
<em class="property">class </em><code class="descclassname">forward_models.</code><code class="descname">EPDiffImage</code><span class="sig-paren">(</span><em>sz</em>, <em>spacing</em>, <em>params=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#EPDiffImage"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.EPDiffImage" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward model for the EPdiff equation. State is the momentum, m, and the image I:
<span class="math">\((m_1,...,m_d)^T_t = -(div(m_1v),...,div(m_dv))^T-(Dv)^Tm\)</span></p>
<p><span class="math">\(v=Km\)</span></p>
<p><span class="math">\(I_t+\nabla I^Tv=0\)</span></p>
<dl class="method">
<dt id="forward_models.EPDiffImage.f">
<code class="descname">f</code><span class="sig-paren">(</span><em>t</em>, <em>x</em>, <em>u</em>, <em>pars</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#EPDiffImage.f"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.EPDiffImage.f" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to be integrated, i.e., right hand side of the EPDiff equation:
<span class="math">\(-(div(m_1v),...,div(m_dv))^T-(Dv)^Tm\)</span></p>
<p><span class="math">\(-\nabla I^Tv\)</span></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>t</strong> – time (ignored; not time-dependent)</li>
<li><strong>x</strong> – state, here the vector momentum, m, and the image, I</li>
<li><strong>u</strong> – ignored, no external input</li>
<li><strong>pars</strong> – ignored (does not expect any additional inputs)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">right hand side [m,I]</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="forward_models.EPDiffMap">
<em class="property">class </em><code class="descclassname">forward_models.</code><code class="descname">EPDiffMap</code><span class="sig-paren">(</span><em>sz</em>, <em>spacing</em>, <em>params=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#EPDiffMap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.EPDiffMap" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward model for the EPDiff equation. State is the momentum, m, and the transform, <span class="math">\(\phi\)</span>
(mapping the source image to the target image).
<span class="math">\((m_1,...,m_d)^T_t = -(div(m_1v),...,div(m_dv))^T-(Dv)^Tm\)</span></p>
<p><span class="math">\(v=Km\)</span></p>
<p><span class="math">\(\phi_t+D\phi v=0\)</span></p>
<dl class="method">
<dt id="forward_models.EPDiffMap.f">
<code class="descname">f</code><span class="sig-paren">(</span><em>t</em>, <em>x</em>, <em>u</em>, <em>pars</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#EPDiffMap.f"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.EPDiffMap.f" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to be integrated, i.e., right hand side of the EPDiff equation:
:math:<a href="#id1"><span class="problematic" id="id2">`</span></a>-(div(m_1v),…,div(m_dv))^T-(Dv)^Tm’</p>
<p><span class="math">\(-D\phi v\)</span></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>t</strong> – time (ignored; not time-dependent)</li>
<li><strong>x</strong> – state, here the image, vector momentum, m, and the map, <span class="math">\(\phi\)</span></li>
<li><strong>u</strong> – ignored, no external input</li>
<li><strong>pars</strong> – ignored (does not expect any additional inputs)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">right hand side [m,phi]</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="forward_models.EPDiffScalarMomentum">
<em class="property">class </em><code class="descclassname">forward_models.</code><code class="descname">EPDiffScalarMomentum</code><span class="sig-paren">(</span><em>sz</em>, <em>spacing</em>, <em>params</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#EPDiffScalarMomentum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.EPDiffScalarMomentum" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for scalar momentum EPDiff solutions. Defines a smoother that can be commonly used.</p>
</dd></dl>

<dl class="class">
<dt id="forward_models.EPDiffScalarMomentumImage">
<em class="property">class </em><code class="descclassname">forward_models.</code><code class="descname">EPDiffScalarMomentumImage</code><span class="sig-paren">(</span><em>sz</em>, <em>spacing</em>, <em>params=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#EPDiffScalarMomentumImage"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.EPDiffScalarMomentumImage" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward model for the scalar momentum EPdiff equation. State is the scalar momentum, lam, and the image I
<span class="math">\((m_1,...,m_d)^T_t = -(div(m_1v),...,div(m_dv))^T-(Dv)^Tm\)</span></p>
<p><span class="math">\(v=Km\)</span></p>
<p>:math:’m=lambdanabla I`</p>
<p><span class="math">\(I_t+\nabla I^Tv=0\)</span></p>
<p><span class="math">\(\lambda_t + div(\lambda v)=0\)</span></p>
<dl class="method">
<dt id="forward_models.EPDiffScalarMomentumImage.f">
<code class="descname">f</code><span class="sig-paren">(</span><em>t</em>, <em>x</em>, <em>u</em>, <em>pars</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#EPDiffScalarMomentumImage.f"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.EPDiffScalarMomentumImage.f" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to be integrated, i.e., right hand side of the EPDiff equation:</p>
<p><span class="math">\(-(div(m_1v),...,div(m_dv))^T-(Dv)^Tm\)</span></p>
<p><span class="math">\(-\nabla I^Tv\)</span></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Math:</th><td class="field-body"><p class="first"><cite>-div(lambda v)</cite></p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>t</strong> – time (ignored; not time-dependent)</li>
<li><strong>x</strong> – state, here the scalar momentum, lam, and the image, I, itself</li>
<li><strong>u</strong> – no external input</li>
<li><strong>pars</strong> – ignored (does not expect any additional inputs)</li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">right hand side [lam,I]</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="forward_models.EPDiffScalarMomentumMap">
<em class="property">class </em><code class="descclassname">forward_models.</code><code class="descname">EPDiffScalarMomentumMap</code><span class="sig-paren">(</span><em>sz</em>, <em>spacing</em>, <em>params=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#EPDiffScalarMomentumMap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.EPDiffScalarMomentumMap" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward model for the scalar momentum EPDiff equation. State is the scalar momentum, lam, the image, I, and the transform, phi.
<span class="math">\((m_1,...,m_d)^T_t = -(div(m_1v),...,div(m_dv))^T-(Dv)^Tm\)</span></p>
<p><span class="math">\(v=Km\)</span></p>
<p><span class="math">\(m=\lambda\nabla I\)</span></p>
<p><span class="math">\(I_t+\nabla I^Tv=0\)</span></p>
<p><span class="math">\(\lambda_t + div(\lambda v)=0\)</span></p>
<p><span class="math">\(\Phi_t+D\Phi v=0\)</span></p>
<dl class="method">
<dt id="forward_models.EPDiffScalarMomentumMap.f">
<code class="descname">f</code><span class="sig-paren">(</span><em>t</em>, <em>x</em>, <em>u</em>, <em>pars</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/forward_models.html#EPDiffScalarMomentumMap.f"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#forward_models.EPDiffScalarMomentumMap.f" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to be integrated, i.e., right hand side of the EPDiff equation:</p>
<p><span class="math">\(-(div(m_1v),...,div(m_dv))^T-(Dv)^Tm\)</span></p>
<p><span class="math">\(-\nabla I^Tv\)</span></p>
<p><span class="math">\(-div(\lambda v)\)</span></p>
<p><span class="math">\(-D\Phi v\)</span></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>t</strong> – time (ignored; not time-dependent)</li>
<li><strong>x</strong> – state, here the scalar momentum, lam, the image, I, and the transform, <span class="math">\(\phi\)</span></li>
<li><strong>u</strong> – ignored, no external input</li>
<li><strong>pars</strong> – ignored (does not expect any additional inputs)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">right hand side [lam,I,phi]</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="image_sampling.html" class="btn btn-neutral float-right" title="Image sampling" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="finite_differences.html" class="btn btn-neutral" title="Finite differences" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Marc Niethammer.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>